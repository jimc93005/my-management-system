
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <style>
        /* PDF Page Setup */
        @page {
            size: A4;
            margin: 8mm 12mm; /* Reduced top margin to move content up */
        }

        body {
            font-family: 'Helvetica', 'Arial', sans-serif;
            font-size: 11pt;
            line-height: 1.3;
            color: #333;
            margin: 0;
            padding: 0;
        }

        /* Colors */
        :root {
            --primary: #1a436d;
            --secondary: #4a7ab5;
            --light-blue: #f2f7fb;
            --border-color: #d1d9e6;
        }

        /* ========= WATERMARK ========= */
        #watermark {
            position: fixed;
            top: 25%;
            left: 10%;
            width: 80%;
            opacity: 0.06; /* Very faint */
            z-index: -1000;
            text-align: center;
        }
        #watermark img {
            width: 450px;
        }

        /* ========= HEADER LAYOUT ========= */
        .header-container {
            width: 100%;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .header-table {
            width: 100%;
            border: none;
        }

        .header-table td {
            border: none;
            vertical-align: middle;
            padding: 0;
        }

        .logo-cell {
            width: 80pt;
        }

        .logo-img {
            height: 75pt;
            width: auto;
        }

        .school-info {
            text-align: center;
        }

        .school-info h1 {
            font-size: 24pt;
            color: var(--primary);
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .motto {
            font-style: italic;
            font-size: 10pt;
            color: #555;
            margin: 2pt 0;
        }

        .contact-info {
            font-size: 9pt;
            margin: 2pt 0;
        }

        /* ========= STUDENT SUMMARY STRIP ========= */
        .summary-box {
            background-color: var(--light-blue);
            padding: 8pt;
            border-radius: 4px;
            margin-bottom: 15pt;
            border: 1px solid var(--border-color);
        }

        .summary-table {
            width: 100%;
            border: none;
        }

        .summary-table td {
            border: none;
            padding: 2pt 5pt;
            font-size: 10pt;
        }

        .label {
            font-weight: bold;
            color: var(--primary);
            text-transform: uppercase;
            font-size: 8.5pt;
        }

        /* ========= DATA TABLE ========= */
        h3 {
            font-size: 14pt;
            color: var(--primary);
            margin-bottom: 8pt;
            text-transform: uppercase;
            border-left: 5px solid var(--primary);
            padding-left: 10pt;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 5pt;
        }

        .results-table th {
            background-color: var(--primary);
            color: white;
            text-transform: uppercase;
            font-size: 9pt;
            padding: 10pt;
            text-align: left;
            border: 1px solid var(--primary);
        }

        .results-table td {
            border: 1px solid var(--border-color);
            padding: 8pt 10pt;
        }

        /* Zebra Stripes */
        .results-table tr:nth-child(even) {
            background-color: #fafafa;
        }

        .subject-name {
            font-weight: bold;
            color: #000;
        }

        .score-cell {
            font-weight: bold;
            text-align: center;
        }

        /* ========= COMMENTS SECTION ========= */
        .comments-section {
            margin-top: 15pt;
        }

        .comment-box {
            border: 1px solid var(--border-color);
            padding: 10pt;
            min-height: 40pt;
            background-color: #fff;
            margin-top: 5pt;
            font-style: italic;
        }

        /* ========= FOOTER / SIGNATURES ========= */
        .footer-table {
            width: 100%;
            margin-top: 40pt;
            border: none;
        }

        .footer-table td {
            border: none;
            width: 33%;
            text-align: center;
            vertical-align: bottom;
        }

        .signature-line {
            border-top: 1px solid #000;
            width: 80%;
            margin: 0 auto 5pt auto;
        }

        .stamp {
            height: 80pt;
            opacity: 0.8;
        }
    </style>
</head>

<body>

    <div id="watermark">
      {% if school_logo_uri %}
                <img src="{{ school_logo_uri }}"
                     style="display: block; margin: 0 auto 10px auto; height: 80px; width: auto;">
            {% else %}
                <p style="color: red;">[Logo Missing]</p>
      {% endif %}
    </div>

    <div class="header-container">
        <table class="header-table">
            <tr>
                <td class="logo-cell">
                   {% if school_logo_uri %}
                       <img src="{{ school_logo_uri }}"
                        style="display: block; margin: 0 auto 10px auto; height: 80px; width: auto;">
                    {% endif %}
                </td>
                <td class="school-info">
                    <h1>{{ school_profile.name }}</h1>
                    {% if school_profile.motto %}
                        <p class="motto">"{{ school_profile.motto }}"</p>
                    {% endif %}
                    <p class="contact-info">
                        <strong>Tel:</strong> {{ school_profile.contact }}
                        {% if school_profile.email %} | <strong>Email:</strong> {{ school_profile.email }}{% endif %}
                    </p>
                    <p class="contact-info"><strong>Headteacher:</strong> {{ school_profile.headteacher_name }}</p>
                </td>
                <td class="logo-cell"></td> </tr>
        </table>
    </div>

    <div class="summary-box">
        <table class="summary-table">
            <tr>
                <td><span class="label">Student Name:</span><br><strong>{{ student.first_name.upper }} {{ student.surname.upper }}</strong></td>
                <td><span class="label">Academic Year:</span><br><strong>{{ academic_year }}</strong></td>
                <td><span class="label">Term:</span><br><strong>{{ term }}</strong></td>
                <td><span class="label">Class:</span><br><strong>{{ student.class_level }}</strong></td>
            </tr>
            <tr>
                <td><span class="label">Position:</span><br><strong>{{ position }} / {{ total_students }}</strong></td>
                <td><span class="label">Average Score:</span><br><strong>{{ average }}%</strong></td>
                <td><span class="label">Status:</span><br><strong>{{ promotion_status|default:"N/A" }}</strong></td>
            </tr>
        </table>
    </div>

    <h3>Academic Performance</h3>
    <table class="results-table">
        <thead>
            <tr>
                <th width="20%">Subject</th>
                <th width="15%">Score</th>
                <th width="15%">Position</th>
                <th width="15%">Remark</th>
                <th width="30%">Comment</th>


            </tr>
        </thead>
        <tbody>
            {% for grade in grades %}
            <tr>
                <td class="subject-name">{{ grade.subject.name }}</td>
                <td class="score-cell">{{ grade.score }}</td>
                <td class="score-cell">
                    {{ grade.subject_position }} / {{ grade.subject_total }}
                </td>
                <td>{{ grade.get_remark }}</td>
                <td>{{ grade.get_comment }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="comments-section">
        <p><span class="label">Class Teacher's Comment:</span></p>
        <div class="comment-box">{{ class_comment|default:"No comment provided." }}</div>

        <p style="margin-top: 10pt;"><span class="label">Headteacher's Remarks:</span></p>
        <div class="comment-box">{{ head_remark|default:"Progressing well." }}</div>
    </div>

    <table class="footer-table">
        <tr>
            <td>
                <div class="signature-line"></div>
                <strong>Class Teacher</strong>
            </td>
            <td>
                {% if stamp_base64 %}
                    <img src="data:image/png;base64,{{ stamp_base64 }}" class="stamp">
                {% endif %}
            </td>
            <td>
                <div class="signature-line"></div>
                <strong>Headteacher</strong>
            </td>
        </tr>
    </table>

</body>
</html>